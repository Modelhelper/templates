{
    "Key": "sql.spinsertupdate",
    "Name": "SQL SP insert update",
    "Description": "",
    "Language": "sql",
    "CanExport": false,
    "ExportFileName": "sp-insertupdate-to-{{model.Table.Name}}.sql",
    "TemplateType": 0,
    "Tags": ["sql"],
    "Body": [

    "USE [<name>]",
    "GO",
    "",
    "SET ANSI_NULLS ON",
    "GO",
    "",
    "SET QUOTED_IDENTIFIER ON",
    "GO",
    "",
    "",
     
    "CREATE PROCEDURE [dbo].[{{ model.Table.Name }}_SP_InsertUpdate]",
    "",
    "{%- for column in model.Table.Columns -%}@{{column.Name }} {{column.DataType | sql}} {% if column.UseLength %}({% if column.Length == -1 %}max{% else %}{{column.Length}}{% endif %}){% endif %}{% if forloop.last == false %}, {% endif %}",
    "{%- endfor -%}",
    "",
    "AS",
    "BEGIN",    
    "",
        "Declare @Count as int;{% capture pkList %}{% for pk in model.Table.PrimaryKeys %}{% if forloop.first == false %} AND {% endif %}{{ pk.Name }} = @{{ pk.Name }}{% endfor %}{% endcapture %} ",
    "Select @Count = count(*) from {{model.Table.Name}} where {{ pkList }}",
    "",
        "IF @Count = 0  ",
    "",
        "/* Ved opprettelse av nye elementer */",
    "",
    "{% sqlInsert %}",
    "",
    " ELSE",
    " ",
    " /* Oppdatering av eksisterende */",
    " ",
    "{% sqlUpdate %}",
    " END",
    " GO",
    " "    
    ]
  }
  