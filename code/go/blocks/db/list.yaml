version: 3
name: go-blocks-db-list
language: go
type: block
short: Entity body for getting a list from database. Must be inside func and expects a db obj
key: model
model: entity
body: |  
  list := {{ .Name | singular }}{}

  ctx := context.Background()

  query := ``

  stmt, err := db.PrepareContext(ctx, query)

  if err != nil {
    return nil, err
  }

  rows, err := stmt.Query(query)
  if err != nil {
    return nil, err
  }

  defer rows.Close()

  var o {{ .Name | singular }}
  
  for rows.Next() {

    if err := rows.Scan(
      {{ range .Columns -}}       
      &o.{{ .Name }},
      {{ end }}); err != nil {
      return nil, err
    } else {
      list = append(list, o)
    }

  }

  return &list, nil